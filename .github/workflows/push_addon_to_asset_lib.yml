name: "Push Addon To Asset Lib"
on:
  workflow_dispatch:
    inputs:
      plugin_version:
        description: 'Plugin version number:'
        required: true
        type: string
        default: '1.0.0'
  push:
    branches: [ addon ]
    

jobs:
  env-setup:
    name: "Setup env variables"
    runs-on: ubuntu-latest
    outputs:
      plugin_version: ${{ steps.set_godot_version.outputs.plugin_version }}
    steps:
    - name: Checkout
      uses: actions/checkout@v3
  
    - name: set_plugin_version
      id: set_plugin_version
      run: |
          VERSION=$(grep version addons/inventory-system/plugin.cfg | cut -d "=" -f 2 | tr -d '"')
          echo "plugin_version=${VERSION}" >> $GITHUB_OUTPUT
  publish:
    needs: [env-setup]
    runs-on: ubuntu-latest
    name: Publish new version to asset lib

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Godot Asset Lib
      # You may pin to the exact commit or the version.
      # uses: deep-entertainment/godot-asset-lib-action@81addbb4db62199a69e4aa5535741a8928d6abb6
      uses: deep-entertainment/godot-asset-lib-action@v0.4.0
      with:
        action: addEdit
        # Godot asset lib username
        username: expressobits
        # Godot asset lib password
        password: ${{ secrets.GODOT_ASSET_LIB_PASSWORD }}
        # ID of the asset in the asset store
        assetId: 1650
        # Path to asset template file
        assetTemplate: .github/workflows/.asset-template-addons.json.hb
        # Godot asset lib base url
        baseUrl: https://godotengine.org/asset-library/api
